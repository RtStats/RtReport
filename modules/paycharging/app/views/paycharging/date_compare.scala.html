@(date1: String, date2: String, date3: String,
   xTimestamp: Array[String],
   xDate1: Array[Long], sumDate1: Long,
   xDate2: Array[Long], sumDate2: Long,
   xDate3: Array[Long], sumDate3: Long
)(implicit lang: Lang)
@import com.github.ddth.plommon.utils._
@import play.mvc._
@import vngup.rtreports.common._
@_layout(
	active   = "date-compare",
	customJs = Array("highcharts-4.0.3/js/highcharts.js","highcharts-4.0.3/js/highcharts-3d.js",
	    "avant-1.2.1/assets/plugins/form-datepicker/js/bootstrap-datepicker.js"
	)
){
<div id="page-heading">
    <ol class="breadcrumb">
        <li><a href="@controllers.paycharging.routes.ModuleController.dashboard(0)">@Messages("msg.dateCompare")</a></li>
    </ol>
</div>
    
<div class="container">
    <div class="row">
        <div class="col-md-12">
            @_macro_displayPageFlashMessage(Controller.flash(controllers.paycharging.ModuleController.VIEW_DATE_COMPARE))
        </div>
    </div>
        
    <div class="row">
        <div class="col-md-12">
	        <div class="panel panel-info">
		        <div class="panel-heading"><h3 class="panel-title">@Messages("msg.dateCompare")</h3></div>
		        <div class="panel-body">
		            <form class="form-horizontal row-border" role="form" method="get">
		                <div class="form-group">
                            <div class="col-sm-5">
                                <div class="input-group date" id="datepicker1">
                                    <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                    <input type="text" class="form-control" id="date1" name="date1" value="@date1" />
                                </div>
                            </div>
                            <div class="col-sm-5">
                                <div class="input-group date" id="datepicker2">
                                    <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                    <input type="text" class="form-control" id="date2" name="date2" value="@date2" />
                                </div>
                            </div>
                            <div class="col-sm-2">
                                <button type="submit" class="btn btn-primary">@Messages("msg.update")</button>
                            </div>
                        </div>
		            </form>
		            <div class="container" style="width: 100%">
		                <div id="_highcharts" style="width: 100%"></div>
		            </div>
		            
		            <div class="container" style="margin-bottom: 10px;">
                        <a class="btn btn-info btn-sm" onclick="javascript:exportExcel('report_table', 'datecompare_@(date1)_@(date2).xls');" id="exportExcel"><i class="fa fa-file-excel-o"></i>&nbsp; Export Excel</a>
                    </div>

		            <div class="container table-responsive">
			            <table class="table table-striped table-bordered table-condensed" id="report_table">
		                    <thead>
		                        <tr>
		                            <th style="text-align: center">Time</th>
		                            <th style="text-align: center">@date1</th>
		                            <th style="text-align: center">@date2</th>
		                            <th style="text-align: center">@date3</th>
		                        </tr>
		                    </thead>
		                    <tbody>
		                        @defining(xTimestamp.length){n => 
		                            @for(i <- 0 to (n-1)){
		                                <tr>
		                                    <td style="text-align: center">@xTimestamp(i)</td>
		                                    <td style="text-align: center">@("%,d".format(xDate1(i)))</td>
		                                    <td style="text-align: center">@("%,d".format(xDate2(i)))</td>
		                                    <td style="text-align: center">@("%,d".format(xDate3(i)))</td>
		                                </tr>
		                            }
		                        }
		                    </tbody>
		                    <tfoot>
		                        <tr>
		                            <th style="text-align: center;">Total</th>
		                            <th style="text-align: center">@("%,d".format(sumDate1))</th>
		                            <th style="text-align: center">@("%,d".format(sumDate2))</th>
		                            <th style="text-align: center">@("%,d".format(sumDate3))</th>
		                        </tr>
		                    </tfoot>
		                </table>
		            </div>
		        </div>
		    </div>
        </div>
    </div>
</div>

<script type="text/javascript">
var CHART;
var DATA;

$(document).ready(function(){
    var now = new Date();
    $('#date1,#date2').datepicker({
        format:  'yyyy-mm-dd',
        endDate: 'today' /* can not select date in future */
    });

    Highcharts.setOptions({
        global: {
            useUTC: false
        }
    });
    
    DATA = [{
        id  : '@date1',
        name: '@date1',
        data: [@defining(xTimestamp.length){n => @for(i <- 0 to (n-1)){['@xTimestamp(i)',@xDate1(i)],}}]
    },{
        id  : '@date2',
        name: '@date2',
        data: [@defining(xTimestamp.length){n => @for(i <- 0 to (n-1)){['@xTimestamp(i)',@xDate2(i)],}}]
    },{
        id  : '@date3',
        name: '@date3',
        data: [@defining(xTimestamp.length){n => @for(i <- 0 to (n-1)){['@xTimestamp(i)',@xDate3(i)],}}]
    }];
    OPT_XAXIS = {
            allowDecimals: false,
            categories   : [@defining(xTimestamp.length){n => @for(i <- 0 to (n-1)){'@xTimestamp(i)',}}]
        };
    OPT_CHART_SPLINE = {
                lineWidth: 2,
                marker: {
                    enabled: true
                },
            };
    OPT_CHART_COLUMN = {
                //depth: 25,
                //pointPadding: 2,
                //borderWidth : 2,
                //groupPadding: 2,
                //shadow      : true
            };
    
    CHART = new Highcharts.Chart({
        chart: {
            renderTo: '_highcharts',
            type    : 'column',
            options3d: {
                enabled: true,
                alpha: 30,
                beta: 0,
                depth: 50,
                viewDistance: 25
            }
        },
        title: { text: null, style: {display: 'none'} },
        //plotOptions: { column: OPT_CHART_COLUMN, spline: OPT_CHART_SPLINE },
        xAxis: OPT_XAXIS,
        yAxis: {
            title          : {text: 'XU'},
            minTickInterval: 1,
            min            : 0
        },
        series: DATA,
        colors: ['#ff0000', '#009010', '#0000ff'],
        @*
        tooltip: {
            formatter: function() {
                return '<b>'+ this.series.name + ': '
                    + Highcharts.numberFormat(this.y, 0) + '</b><br/>'
                    + '<small>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +'</small>';
            }
        }
        *@
    });
});
function exportExcel(data,name_file)
{
        //var postfix = day + "." + month + "." + year + "_" + hour + "." + mins;
        //creating a temporary HTML link element (they support setting file names)
        var a = $('#exportData');
        //var start = $("#start_year").val()+$("#start_month").val()+$("#start_day").val();
        //var end   = $("#end_year").val()+$("#end_month").val()+$("#end_day").val();
       // var postfix = start +"_to_"+ end;
        //getting data from our div that contains the HTML table
        var data_type = 'data:application/vnd.ms-excel';
        
        var table_div = document.getElementById(data);
        var table_html = table_div.outerHTML;
        table_html = table_html.replace(/ /g, '%20')
        
        a.attr('href',data_type + ', ' + table_html);
        //setting the file name
        a.attr('download',name_file  + '.xls');
}
</script>   
}
