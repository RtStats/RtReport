@(fromDateStr: String, toDateStr: String, xTimestamp: Array[Long], xTotal: Array[Long], xSuccessful: Array[Long], xFailed: Array[Long])(implicit lang: Lang)
@import com.github.ddth.plommon.utils._
@import play.mvc._
@import vngup.rtreports.common._
@_layout(
	active   = "login-summary",
	customJs = Array("highcharts-3.0.9/js/highcharts.js",
				"bootstrap/js/jquery.min.js","bootstrap/js/bootstrap.min.js",
				"bootstrap-daterangepicker-1.3.6/moment.min.js",
				"bootstrap-daterangepicker-1.3.6/daterangepicker.js"
				),
	customCss = Array("bootstrap-daterangepicker-1.3.6/daterangepicker-bs3.css",
				"bootstrap/css/bootstrap.min.css")
){

<div id="page-heading">
    <ol class="breadcrumb">
        <li><a href="@controllers.pplogin.routes.ModuleController.dashboard()">@Messages("msg.dashboard")</a></li>
        <li class="active">@Messages("msg.login_summary")</li>
    </ol>
    @*<h1>@Messages("msg.dashboard")</h1>*@
</div>
    
<div class="container">
    <div class="row">
        <div class="col-md-12">
            @defining(Controller.flash(controllers.pplogin.ModuleController.VIEW_DASHBOARD)){flashMsg =>
                @if(flashMsg!=null && !flashMsg.equals("")){
                    <div class="alert alert-info alert-dismissable">
                        <i class="fa fa-info-circle"></i> @flashMsg
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">x</button>
                    </div>
                }
            }
        </div>
    </div>
        
    <div class="row">
        <div class="col-md-12">
	        <div class="panel panel-info">
		        <div class="panel-heading"><h3 class="panel-title">Passport Login</h3></div>
		        <div class="well">
                	<div class="control-group">
                  		<label class="control-label" for="reporttime">Choose datetime:</label>
	                   	 <div class="controls">
		                     	<div class="input-prepend input-group">
			                          <span class="add-on input-group-addon"><i class="fa fa-calendar"></i></span>
			                       	  <input type="text" style="width: 400px" name="reporttime" id="reporttime" class="form-control" value="@fromDateStr - @toDateStr"  class="span4"/>
			                       	  <button type="button" class="btn btn-primary" onclick="_loadData()"> @Messages("msg.update")</button>
		                     	</div>
	                   	</div>
                    </div>
		        </div>
		        <div class="panel-body">
		            <div class="container" style="width: 100%">
		                <div id="_highcharts" style="width: 100%"></div>
		            </div>
		        </div>
		    </div>
        </div>
    </div>
</div>

<script type="text/javascript">
var CHART;
var DATA;

function _loadData() {
	var datetime = $("#reporttime").val();

    $.ajax({
    	type: 'GET',
        url: '@controllers.pplogin.routes.JsonController.jsonLoginSummary()'+'?datetime='+ datetime,
        success: function(jsonResult) {
            for (var i = 0; i < jsonResult.length; i++) {
                var serieObject = jsonResult[i];
                var serieLabel = serieObject.name;
                var serieData = serieObject.data;
                var chartSerie = CHART.get(serieLabel);
                if (chartSerie == null) { // chart serie is not defined
                    CHART.addSeries({id:serieLabel, data:[], name:serieLabel});
                    chartSerie = CHART.get(serieLabel);
                }
                if (chartSerie != null ) {
                    //chartSerie.addPoint(serieData[serieData.length-1], true, true);
                    chartSerie.setData(serieData, true, false, true);
                }
            }
            //setTimeout(_loadData, 1*1000);
        },
        error: function (jqXHR, textStatus, errorThrown) {
        	alert("Error: " + jqXHR.responseText);
        },
        cache: false
    });
}
    
$(document).ready(function(){
	$body = $("body");
    $(document).on({
    	ajaxStart: function() { $body.addClass("loading");    },
        ajaxStop : function() { $body.removeClass("loading"); }    
    });
	
    Highcharts.setOptions({
        global: {
            useUTC: false
        }
    });
    
    DATA = [
        {
            id  : 'Total',
            name: 'Total',
            data: [@defining(xTimestamp.length){n => @for(i <- 0 to (n-1)){[@xTimestamp(i),@xTotal(i)],}}]
        }, {
            id  : 'Successful',
            name: 'Successful',
            data: [@defining(xTimestamp.length){n => @for(i <- 0 to (n-1)){[@xTimestamp(i),@xSuccessful(i)],}}]
        }, {
            id  : 'Failed',
            name: 'Failed',
            data: [@defining(xTimestamp.length){n => @for(i <- 0 to (n-1)){[@xTimestamp(i),@xFailed(i)],}}]
        }
    ];
    CHART = new Highcharts.Chart({
        chart: {
            renderTo: '_highcharts',
            type    : 'spline',
            events  : {
               /*  load: _loadData */
            }
        },
        plotOptions: {
            spline: {
                lineWidth: 1,
                marker: {
                    enabled: false
                },
            }
        },
        title: { text: null, style: {display: 'none'} },
        xAxis: {
            type: 'datetime',
            minTickInterval: 0.5,
            dateTimeLabelFormats: {
                millisecond: '%H:%M:%S.%L',
                second: '%H:%M:%S',
                minute: '%H:%M',
                hour: '%H:%M',
                day: '%d-%m',
                week: '%e. %b',
                month: '%b \'%y',
                year: '%Y'
            }
        },
        yAxis: {
            title          : {text: '# requests'},
            minTickInterval: 1,
            min            : 0
        },
        series: DATA,
        colors: ['#0000f0', '#009010', '#f00000'],
        tooltip: {
            formatter: function() {
                return '<b>'+ this.series.name + ': '
                    + Highcharts.numberFormat(this.y, 0) + '</b><br/>'
                    + '<small>' + Highcharts.dateFormat('%Y-%m-%d %H:%M', this.x) +'</small>';
            }
        },
        legend: {
            enabled: true
        }
    });
    
    $('#reporttime').daterangepicker({	
        timePicker: true,
        timePickerIncrement: 60,
        format: 'MM/DD/YYYY h:mm A'
    }, function(start, end, label) {
    	console.log(start.toISOString(), end.toISOString(), label);
    });
});
</script>   
 

}